# 更新日志

## 0.5.0 2025-06-20 完成仓库模块前端开发剩余工作

完成了仓库模块前端开发的剩余工作：

1. 更新了仓库列表页面(Warehouse.vue)，替换模拟数据为实际API调用
2. 更新了仓库详情页面(WarehouseDetail.vue)，实现对真实数据的展示和处理
3. 更新了物品详情页面(ItemDetail.vue)，集成API数据并添加相关功能
4. 增加了用户权限验证，根据不同角色显示不同的操作选项
5. 添加了加载状态、空数据状态处理
6. 优化了UI界面和交互体验

实现了与后端API的完整集成，确保了数据的一致性和实时性。 

## 0.4.9 (2025-06-20 14点56分)

### 添加
- 优化仓库模块后端API结构
  - 创建StockRecordController类，将出入库相关API从WarehouseItemController中分离
  - 创建QRCodeController类，将二维码相关API从WarehouseItemController中分离
  - 创建WarehouseStatsController类，实现统计报表相关API
  - 实现UserContext工具类，用于获取当前登录用户信息
  - 添加StockRecordMapper.getMaxSequence方法，用于生成出入库记录编号
  - 添加QRCodeServiceImpl.parseItemQRCode方法，实现二维码解析功能
- 创建单元测试
  - 创建WarehouseItemControllerTest类，测试物品管理相关API
  - 创建StockRecordControllerTest类，测试出入库相关API
  - 创建QRCodeControllerTest类，测试二维码相关API
  - 创建WarehouseStatsControllerTest类，测试统计报表相关API

### 目的
优化仓库模块后端API结构，使API路径与文档一致，职责更加明确，代码更加清晰。同时，添加单元测试，提高代码质量和可维护性。通过这些优化，使仓库模块的API更加符合RESTful设计规范，更易于使用和维护。

## 0.4.8 (2025-06-19 16点30分)

### 添加
- 实现仓库模块后端功能
  - 实现QRCodeServiceImpl类，提供二维码生成和解析功能
  - 实现StockRecordServiceImpl类，提供出入库记录管理功能
  - 实现WarehouseItemServiceImpl类，提供仓库物品管理功能
  - 实现ItemRequestServiceImpl类，提供物品申请管理功能
  - 实现InventoryCheckServiceImpl类，提供盘库管理功能
  - 创建WarehouseController类，实现仓库管理相关API
  - 创建WarehouseItemController类，实现仓库物品管理相关API
  - 创建ItemRequestController类，实现物品申请管理相关API
  - 创建InventoryCheckController类，实现盘库管理相关API

### 目的
完成仓库模块后端功能的实现，包括仓库管理、物品管理、出入库管理、物品申请和盘库管理等功能，为前端提供完整的API支持。通过实现各个服务类和控制器类，确保仓库模块的所有功能都能正常工作。

## 0.4.7 (2025-06-19 15点10分)

### 修复
- 修复了消息详情页面在查看公告类型消息时出现500错误的问题
  - 修改了announcement.js中的API调用函数，使其与后端API路径和参数类型一致
  - 在getAnnouncementDetail函数中添加了ID类型转换，确保传递的是数字类型
  - 更新了markAnnouncementRead函数，使用路径参数而非请求体参数

### 目的
解决消息详情页面显示公告内容时出现的500错误问题，确保前端API调用与后端API定义保持一致，提高系统稳定性和用户体验。

## 0.4.6 (2025-06-19 14点07分)

### 添加
- 创建更新日志，记录项目变更
  - 添加版本号0.4.6
  - 添加时间戳2025-06-19 07:10
  - 根据之前的日志格式保持一致性

### 目的
确保项目变更得到记录，便于团队成员了解项目进展和变更历史，提高项目透明度和可追踪性。

## 0.4.5 (2025-06-19 01:52)

### 修复
- 修复了AnnouncementServiceImpl.java的报错问题
  - 更新AnnouncementReadMapper.xml，使方法名与接口定义一致
  - 添加缺失的SQL语句实现
  - 更新AnnouncementRead实体类，添加MyBatis Plus注解，使用Lombok简化代码

### 目的
解决因删除Announcement.java实体类后导致的系统公告相关功能错误，确保AnnouncementServiceImpl.java能够正常工作。通过更新XML映射文件和实体类，保持了代码的一致性和规范化。

## 0.4.4 (2025-06-19 00:00)

### 修复
- 修复了SwaggerConfig.java的依赖问题
  - 更新pom.xml，替换Springfox依赖为SpringDoc OpenAPI依赖
  - 简化SwaggerConfig类，移除不必要的配置
  - 添加springdoc.properties配置文件，提供API文档信息
  - 更新application.yml，添加SpringDoc OpenAPI配置

### 目的
解决SwaggerConfig.java的依赖问题，确保API文档功能正常工作。使用更现代化的SpringDoc OpenAPI替代已过时的Springfox Swagger，提高与Spring Boot 2.7.x的兼容性。

## 0.4.3 (2025-06-19 23:45)

### 添加
- 完成数据库与实体类重构工作
  - 重新设计SystemAnnouncement实体类，添加表名注解和字段映射注解
  - 更新AssistanceRequestRecipient实体类，修正字段映射关系
  - 将Announcement类标记为已弃用，转为DTO角色，添加转换方法
  - 更新AnnouncementMapper接口，使用SystemAnnouncement替代Announcement
  - 重构AnnouncementMapper.xml，调整字段映射关系和SQL语句
  - 创建AssistanceRequestRecipientMapper.xml，实现所有接口方法
  - 调整AnnouncementServiceImpl，使用SystemAnnouncement替代Announcement
  - 更新实施进度报告，将数据库与实体类重构相关任务标记为已完成

### 目的
完成数据库与实体类重构工作，确保实体类与数据库表结构完全匹配，解决字段名不一致、表名不匹配等问题。重构MyBatis映射文件，使用规范化的SQL语句和映射定义，提高系统稳定性和可维护性。

## 0.4.2 (2025-06-19 10:40)

### 添加
- 实现数据库与实体类重构基础设施
  - 创建数据库设计规范文档，规范数据库命名、字段类型和索引设计
  - 创建实体类设计规范文档，确保与数据库规范一致
  - 创建数据库修复脚本(db-fix-script.sql)，解决表名不匹配和缺失表问题
  - 创建数据迁移脚本模板(db-migration-script.sql)，用于安全变更表结构
  - 创建数据库版本控制机制文档，使用Flyway管理数据库变更
  - 创建系统回滚方案文档，确保系统更新时可安全回滚
  - 实现统一的API响应格式(Result类)和异常处理机制(GlobalExceptionHandler)
  - 引入Swagger自动化API文档工具，提高API可维护性
  - 引入Flyway数据库版本控制工具，实现数据库变更的版本管理

### 目的
建立完善的数据库设计规范和版本控制机制，解决表名不匹配和缺失表等问题，为后续系统重构奠定基础。同时，引入API文档自动化工具和统一响应格式，提高系统可维护性和开发效率。

## 0.4.1 (2025-06-19 10:15)

### 修复
- 深度修复数据库表与实体类不匹配问题
  - 修改AnnouncementMapper.xml，将字段映射调整为使用别名与实体类匹配
  - 修改AssistanceRequestMapper.xml，通过别名方式解决数据库表与实体类的字段不匹配
  - 修改ChatConversationMapper.xml，调整字段映射关系
  - 创建缺失的AssistanceRequestRecipientMapper.xml文件
  - 使用resultMap定义字段与属性的映射关系，解决命名差异

### 创建文件
- 创建项目规范和分析文档
  - 创建设计规范文档(design-specifications.md)，规范数据库和实体类设计
  - 创建数据库与实体类不匹配分析报告(database-entity-mismatch-analysis.md)
  - 创建数据库重构计划(database-restructure-plan.md)
  - 创建第一阶段实施计划(phase-one-implementation-plan.md)

### 目的
通过优化MyBatis映射文件，使用别名和resultMap的方式临时解决数据库表与实体类不匹配的问题，并为后续全面重构制定了详细计划。此次修复重点解决前端API调用500错误的问题，同时为长期解决方案奠定基础。

## 0.4.0 (2025-06-19 09:40)

### 修复
- 修复数据库表名与Mapper XML文件不匹配的问题
  - 将AnnouncementMapper.xml中的`announcement`表名替换为`system_announcement`
  - 添加缺失的`assistance_request_recipient`表定义到数据库初始化SQL文件
  - 新建AssistanceRequestRecipientMapper.xml文件，实现关联接口的所有方法
  - 创建数据库修复脚本db-fix-script.sql

### 目的
修复前端API调用时出现的500错误问题，通过修正数据库表名与Mapper XML文件的不匹配问题，以及添加缺失的表定义和Mapper文件，确保前后端交互正常。

## 0.3.9 (2025-06-19 10:25)

### 添加
- 完善Messages.vue组件，增强错误处理和用户体验
  - 添加详细的加载状态和错误显示界面
  - 实现错误重试功能和空状态处理
  - 优化时间格式化，根据消息时间显示不同格式
  - 添加分页控制，支持大量消息的浏览
  - 增强数据处理逻辑，确保API返回数据不完整时能正常显示
- 完善ConversationList.vue的协助请求部分
  - 改进API调用逻辑，根据用户角色设置适当的参数
  - 增强数据处理逻辑，兼容不同格式的API响应
  - 添加重试功能和更友好的空状态提示
  - 根据用户角色显示不同的操作按钮

### 目的
提高消息相关组件的稳定性和用户体验，确保在网络不稳定或API响应不完整的情况下也能提供良好的交互体验。增强错误处理和数据处理能力，避免因数据格式不一致导致的前端显示问题。

## 0.3.8 (2025-06-18 06:13)

### 添加
- 修改ChatDetail.vue组件，将模拟数据替换为API调用
  - 实现消息记录获取(getMessageList)
  - 实现消息发送功能(sendMessage)
  - 实现图片上传功能(uploadMessageImage)
  - 实现消息已读标记功能(markMessageRead)
- 修改NewChat.vue组件，接入联系人API
  - 使用getContactsList API替换模拟联系人数据
  - 实现创建会话功能，使用createConversation API
  - 添加分页和错误处理功能
- 修改RequestAssistance.vue组件，接入协助请求API
  - 使用getContactDetail API获取工程师详情
  - 使用createAssistanceRequest API提交协助请求
  - 添加加载状态和错误处理

### 目的
完成前端联系人和消息模块与后端API的连接，替换所有模拟数据，实现真实的数据交互功能。确保用户可以通过前端界面正常使用联系人查询、消息发送、协助请求等功能。

## 0.3.7 (2025-06-17 19:25)

### 删除
- 删除了ContactFavorite.java实体类，因为在数据库初始化SQL和API接口中没有收藏联系人相关定义
- 删除了ContactDTO中的favorite字段，保持与数据库一致
- 删除了contacts.js中收藏联系人相关的API函数，包括getFavoriteContacts、addContactToFavorites和removeContactFromFavorites
- 删除了ContactDetail.vue中的收藏功能UI和相关代码
- 修改了API接口文档中与邮箱相关的示例内容

### 目的
根据联系人和消息模块数据库初始化SQL和API接口文档规范，删除了不符合定义的字段和功能，确保前后端代码与数据库设计和API规范完全一致。

## 0.3.6 (2025-06-17 19:12)

### 删除
- 删除了ContactDTO中的position字段，因为在数据库表和API接口文档中未定义
- 删除了ContactDetail.vue中显示职位的相关部分
- 删除了AssistanceRequestDTO中的mobile字段，因为API接口中未定义
- 删除了AnnouncementDTO中的avatar字段，因为API接口中未定义

### 目的
根据联系人和消息模块数据库初始化SQL和API接口文档规范，删除了不符合定义的字段，确保前后端代码与数据库设计保持一致。

## 0.3.5 (2025-06-17 09:40)

### 添加功能
- 实现工程师详情页中"联系"按钮功能，点击后跳转到聊天详情页
- 创建请求协助页面组件 (RequestAssistance.vue)，实现简化版的协助请求功能
- 实现工程师详情页中"请求协助"按钮功能，点击后跳转到请求协助页面
- 添加请求协助页面的路由配置

### 说明
- 工程师详情页中的联系按钮现在可以跳转到相应工程师的聊天页面
- 新增的请求协助页面提供了简洁的表单用于发送协助请求
- 通过添加相应的路由配置，确保页面导航正常工作
- 完善了工程师沟通和协助功能，提高了工程师间的协作效率

## 0.3.4 
- 重构TaskDetail.vue组件，将其拆分为多个子组件，提高代码可维护性和性能
- 创建并使用以下子组件：
  - TaskStatusCard.vue - 显示和更改任务状态
  - TaskStepItem.vue - 显示任务流程中的单个步骤项
  - TaskStepRecordForm.vue - 添加任务步骤记录
  - TaskStepRecordList.vue - 显示任务步骤记录列表
  - TaskBaseInfoCard.vue - 显示任务基本信息
  - TaskCustomerInfoCard.vue - 显示客户信息
  - TaskDeviceInfoCard.vue - 显示设备信息
  - TaskCustomerFeedbackCard.vue - 显示客户评价
  - CollaboratorsPanel.vue - 显示协作工程师
  - TaskTransferPanel.vue - 显示转出任务选项
- 创建对话框组件：
  - TaskStatusChangeDialog.vue - 更改任务状态
  - CollaborationDialog.vue - 添加协作工程师
  - ConfirmDialog.vue - 通用确认对话框
  - ImagePreviewDialog.vue - 图片预览
  - TaskAssignDialog.vue - 任务分配

### 说明
- 通过组件拆分改善了代码结构，降低了单个文件的复杂度
- 提高了组件的可复用性，便于在其他页面使用这些组件
- 实现了基于角色的权限控制，确保不同角色只能看到和操作允许的内容
- 优化了UI交互，提供更好的用户体验

### 添加功能
- 实现工程师详情页中"联系"按钮功能，点击后跳转到聊天详情页
- 创建请求协助页面组件 (RequestAssistance.vue)，实现简化版的协助请求功能
- 实现工程师详情页中"请求协助"按钮功能，点击后跳转到请求协助页面
- 添加请求协助页面的路由配置

## 0.3.4 

### 修改
- 移除联系人页面中的"请求协助"按钮
- 删除相关的CSS样式和JavaScript函数
- 调整页面底部间距，优化显示效果

### 说明
- 根据需求移除了不需要的UI元素，使界面更加简洁
- 删除了未使用的代码，提高代码质量

## 0.3.3

### 修复
- 修复首页新建任务按钮图标显示问题，将icon-plus替换为标准的Font Awesome图标
- 修复点击新建按钮时控制台报错的问题，添加缺失的API函数
- 创建customer.js API模块，实现客户相关的API函数
- 修复CreateTask.vue中的客户加载逻辑，使用正确的API调用
- 优化了CreateTask.vue中的错误处理，添加了更详细的错误日志

### 说明
- 使用了标准的Font Awesome图标库替代自定义icon-plus类
- 添加了必要的API函数，确保前端功能正常工作
- 优化了代码结构，将API函数按功能模块进行分类

## 0.0.5 

### 修复
- 修复TaskDetail.vue中formatDate未定义导致页面无法显示的问题
- 添加date-fns依赖用于日期格式化
- 添加缺失的formatDate、isDeadlineApproaching、calculateProgress等函数
- 添加getTaskTypeIcon、getPriorityText等用于UI显示的辅助函数
- 补充完善各种权限相关变量和函数
- 完善任务步骤展开/收起相关功能

### 说明
- 通过添加缺失的函数定义解决了任务详情页空白问题
- 修复了JavaScript引用错误，使任务详情页现在能正常显示
- 添加了对date-fns的依赖，确保日期格式化功能正常工作

## 0.0.4 

### 修复
- 修复任务详情页无法显示内容的问题
- 增强TaskDetail.vue中的任务详情加载逻辑，添加更多调试信息
- 修复loadTaskFlow函数，确保正确传递任务ID参数
- 增强task.js中的fetchTaskDetail和fetchTaskFlow函数的错误处理能力
- 添加forceRefresh函数，允许用户强制刷新任务详情

### 说明
- 增强了日志记录，便于排查API调用问题
- 改进了错误处理机制，提供更明确的错误信息
- 修复了任务详情页和任务流程加载的逻辑问题

## 0.0.3

### 修复
- 修复TaskCard组件中的数据处理逻辑，增加了getDeviceInfo和getEngineers方法，确保正确显示任务信息
- 修复Home.vue中的任务列表加载和过滤逻辑，增加了调试信息面板和任务卡片调试模式
- 修复task store中的数据处理逻辑，确保正确解析后端返回的任务列表数据
- 修复TaskDetail.vue中的任务详情加载和任务流程加载逻辑

### 说明
- 增强了数据处理的容错能力，处理可能的空值和格式不一致的情况
- 添加了调试功能，便于排查问题
- 修复了前端与后端API数据格式不匹配的问题

## 0.0.2

### 修复
- 修复任务列表数据字段映射问题，将records改为list
- 添加获取工程师列表的函数
- 移除调试信息面板和TaskCard组件的调试模式
- 修复后端API数据与前端不匹配的问题

### 说明
- 后端API返回的任务列表数据使用list字段，而不是之前预期的records字段
- 添加了日志记录以便更好地调试API响应数据

## 0.0.1

### 修复
- 添加了authStore中缺失的hasRole函数，用于检查用户角色权限
- 修复了Home.vue中角色判断逻辑，添加了try-catch错误处理
- 解决了"authStore hasRole is not a function"错误，使主页能够正常加载
- 为开发测试阶段，hasRole函数暂时返回true，以确保所有功能可用

### 说明
- 在实际部署时需要完善hasRole函数，根据用户实际角色进行权限判断

## 0.0.2 
### 修复
- 修复任务模块数据库初始化脚本中的SQL错误
- 添加sales_id字段到task表的示例数据中，解决外键约束错误

### 目的
修复数据库初始化时遇到的SQL语法错误，确保数据库能够成功初始化。

## 0.0.3 
### 修复
- 修复任务状态更改对话框中取消按钮无响应的问题
  - 简化closeDialog函数实现，移除不必要的事件检查逻辑
- 增强客户信息加载的错误处理和调试能力
  - 在TaskCustomerInfoCard组件中添加详细日志和错误处理
  - 改进组件挂载逻辑，确保在所有条件下都能正确处理

### 目的
提高用户界面的响应性和可用性，修复关键交互问题，并改进错误处理和调试能力，便于排查和解决API响应相关问题。

## 0.0.4 

### 修复
- 修复任务详情页面的API调用和界面渲染问题
  - 调整TaskCustomerInfoCard组件中的API响应处理，解决客户信息加载失败问题
  - 修复TaskDetail.vue中的状态历史API调用和数据处理
  - 添加TaskFlowController组件，恢复任务流程控制功能
  - 优化任务步骤控制逻辑，确保步骤导航按钮正常工作
  - 增强错误处理和日志记录

### 目的
修复任务详情页面在组件拆分后出现的加载错误，恢复客户信息卡片和任务流程功能，提升用户体验。

## 版本更新日志

### 0.3.3

#### 修复和优化：任务模块API与UI对应关系
- 优化了任务API模块结构
  - 创建了专门的taskflow.js文件，分离任务流程相关API
  - 修复了uploadTaskImage函数参数与调用不一致的问题
  - 添加了removeCollaborator函数
- 优化了路由配置
  - 更新为RESTful风格的路由路径（如/task/:id/flow替代/task-flow/:id）
  - 为所有路由添加了props支持，便于组件获取参数
  - 创建了EditTask.vue页面框架
- 修复了前端页面中的链接
  - 更新了Home.vue中的创建任务按钮链接
  - 添加了TaskDetail.vue中的编辑任务和查看流程方法
  - 添加了TaskFlowDetail.vue中的加载状态显示

### 0.3.2 

#### 新增功能：任务模块的前后端功能
- 创建任务服务实现类：TaskServiceImpl
  - 实现了创建任务、查询任务列表、获取任务详情等基本功能
  - 实现了任务流程、任务步骤更新、任务图片上传等高级功能
  - 实现了任务统计功能
- 创建任务控制器：TaskController
  - 实现了RESTful风格的API接口
  - 支持任务的增删改查、流程管理、图片上传等功能
- 前端API接口调用：task.js
  - 实现了与后端API的交互功能
  - 支持文件上传、分页查询等功能
- 前端状态管理：taskStore.js
  - 实现了任务数据的状态管理
  - 支持任务详情的缓存功能，提高用户体验
  - 根据不同用户角色提供不同的数据访问方式

### 0.3.1 

#### 新增功能：用户登录和认证模块
- 添加了登录页面
- 实现了JWT认证
- 添加了记住我功能
- 添加了自动登录功能

## 0.0.1 

### 添加内容
- 添加任务状态历史表（task_status_history）到数据库中
- 为任务状态历史表添加示例数据
- 添加获取任务状态历史的API接口（/api/v1/tasks/{taskId}/status-history）
- 添加客户详情API接口（/api/v1/customer/{customerId}）
- 创建CustomerService接口及实现类
- 创建CustomerMapper接口和XML配置
- 修复TaskDeviceInfoCard组件中的computed未定义错误

### 修改内容
- 更新CustomerController，使用CustomerService替代模拟数据
- 修改TaskService接口，添加获取任务状态历史的方法
- 修改TaskServiceImpl类，实现获取任务状态历史的方法
- 更新TaskMapper接口和XML，添加获取任务状态历史的SQL查询

### 目的
解决任务详情页面的API错误和组件加载问题，实现任务状态历史和客户详情功能的完整前后端交互。

## 版本 0.0.1 - 2024-06-19

### 修改内容
1. 在联系人和消息模块数据库初始化.sql中的assistance_request_recipient表中添加了update_time字段
2. 更新了AssistanceRequestRecipientMapper.xml文件，在以下位置添加了update_time字段：
   - resultMap中添加了update_time字段映射
   - Base_Column_List中添加了update_time字段
   - insert语句中添加了update_time字段
   - batchInsert语句中添加了update_time字段
   - update语句中添加了update_time字段条件
   - markAsRead方法中添加了update_time字段更新

### 修改目的
解决后端代码与数据库表结构不匹配的问题。后端实体类AssistanceRequestRecipient中包含updateTime字段，但数据库表中没有对应的字段，导致可能出现数据映射错误。通过添加update_time字段，确保数据库表结构与后端代码一致，提高系统稳定性。

# 开发日志

## 0.1.0 - 2024-05-13

### 仓库模块前端实现

- 创建了仓库模块API接口(warehouse.js)，实现与后端API的统一交互
- 创建了仓库模块状态管理(warehouse.js)，使用Pinia管理仓库相关状态
- 更新了路由配置，添加了仓库模块的相关路由
- 创建了物品申请页面(ItemRequestPage.vue)
- 创建了盘库操作页面(InventoryCheckPage.vue)
- 创建了统计报表页面(StatsReportPage.vue)
- 更新了物品入库页面(StockInPage.vue)和出库页面(StockOutPage.vue)，使用API服务替换模拟数据

仓库模块前端功能已经基本实现，后续需要进一步测试和优化。

